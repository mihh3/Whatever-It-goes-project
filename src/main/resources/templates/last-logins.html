<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Assistant | Recent Logins</title>
    <link rel="stylesheet" th:href="@{/css/poker-theme.css}">
    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css}" rel="stylesheet">
    <link th:href="@{https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css}" rel="stylesheet">
</head>
<body class="poker-table">
<header class="poker-header">
    <div class="poker-brand">
        <img src="/images/poker-logo.svg" alt="Poker Assistant logo" loading="lazy">
        <div class="poker-brand-text">
            <span class="poker-brand-title">Poker Assistant</span>
            <span class="poker-brand-subtitle">by Michalis Anastasiadis</span>
        </div>
    </div>
    <nav class="poker-nav">
        <a th:href="@{/}">üè† Lobby</a>
    </nav>
</header>

<main class="poker-main">
    <section class="poker-card" style="padding: 0; overflow: hidden;">
        <div style="padding: 2rem 2.5rem 1rem 2.5rem; border-bottom: 1px solid rgba(246,193,119,0.4);">
            <h2 style="margin-bottom: 0.5rem;">Recent player logins</h2>
            <p>Keep track of who joined the tables and when their last session began.</p>
        </div>
        <div class="table-responsive" style="padding: 1.5rem 2.5rem 2rem 2.5rem;">
            <table id="loginsTable" class="table table-striped table-dark poker-table-grid mb-0">
                <thead>
                <tr>
                    <th>Player</th>
                    <th>Last login</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="log : ${logins}">
                    <td th:text="${log.username}"></td>
                    <td th:text="${#temporals.format(log.lastLogin, 'yyyy-MM-dd HH:mm:ss')}"></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div style="padding: 1.5rem 2.5rem 2rem 2.5rem; border-top: 1px solid rgba(246,193,119,0.4); display: flex; justify-content: flex-end;">
            <a th:href="@{/}" class="poker-btn">Back to lobby</a>
        </div>
    </section>
</main>

<footer class="poker-footer">
    Security first: only the right players take a seat.
</footer>

<script th:inline="none" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script th:inline="none" src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="none" src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script th:inline="none" src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
<script th:inline="none">
    document.addEventListener('DOMContentLoaded', function() {
        const table = $('#loginsTable').DataTable({
            pageLength: 10,
            lengthChange: false,
            ordering: false,
            autoWidth: false,
            dom: 'ft<"mt-3"p>'
        });

        setInterval(() => {
            fetch('/api/logins')
                .then(res => res.json())
                .then(data => {
                    table.clear();
                    data.forEach(log => {
                        table.row.add([
                            log.username,
                            new Date(log.lastLogin).toLocaleString()
                        ]);
                    });
                    table.draw(false);
                });
        }, 30000);
    });
</script>
</body>
</html>
